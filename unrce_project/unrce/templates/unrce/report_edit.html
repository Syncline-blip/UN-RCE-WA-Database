{% extends "base.html" %}
{% load static %}


{% block content %}

<h2>Edit Report</h2>
<style>
    .sdg-img {
    width: 100px; /* Adjust as needed */
    height: 100px; /* Adjust as needed */
}
</style>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% for field in report_form %}
        <p>
            {{ field.label_tag }}<br>
            {{ field }}
            {% if field.errors %}
                <div class="error">{{ field.errors|join:", " }}</div>
            {% endif %}
        </p>
{% endfor %}

    <h3>Organization Details</h3>
        <div class="organization-formsets">
            {{ organization_formset.management_form }}
            {% for form in organization_formset %}
                <div class="organization-form" data-prefix="{{ form.prefix }}">
                    {{ form.name.label }}: {{ form.name }}<br>
                    {{ form.email.label }}: {{ form.email }}<br>
                    {{ form.website.label }}: {{ form.website }}<br>
                    <button type="button" class="remove-org-form">Remove</button>
                </div>
            {% endfor %}
            <button type="button" id="add-organization">Add Another Organization</button>
        </div>
    
    <div class="form-group">
    

    <h3>SDGs</h3>
    <div id="sdg-container">
        {% for i in sdg_list %}
            <div class="sdg-item">
                <img src="{% static 'images/sdg_'|add:i|add:'.png' %}" class="sdg-img" data-sdg="{{ i }}" alt="SDG {{ i }}">
                <div class="sdg-options">
                    <input type="radio" name="sdg_option_{{ i }}" value="direct" {% if i|add:0 in report.direct_sdgs %}checked{% endif %}> Direct
                    <input type="radio" name="sdg_option_{{ i }}" value="indirect" {% if i|add:0 in report.indirect_sdgs %}checked{% endif %}> Indirect
                </div>
            </div>
        {% endfor %}
    </div>
    

    
<div id="esd-themes-container">
    {% for theme in themes_esd %}
        <div class="esd-theme-item">
            {{ theme }} 
            <div class="esd-theme-options">
                <input type="radio" name="esd_theme_option_{{ theme }}" value="direct" {% if theme in report.direct_esd_themes %}checked{% endif %}> Direct
                <input type="radio" name="esd_theme_option_{{ theme }}" value="indirect" {% if theme in report.indirect_esd_themes %}checked{% endif %}> Indirect
            </div>
        </div>
    {% endfor %}
</div>

  
  <!-- ESD for 2030-Priority Action Areas -->
  <div id="esd-priority-container">
    {% for area in priority_action_areas %}
        <div class="esd-priority-item">
            {{ area }}
            <div class="esd-priority-options">
                <input type="radio" name="esd_priority_option_{{ area }}" value="direct" {% if area in report.direct_priority_areas %}checked{% endif %}> Direct
                <input type="radio" name="esd_priority_option_{{ area }}" value="indirect" {% if area in report.indirect_priority_areas %}checked{% endif %}> Indirect
            </div>
        </div>
    {% endfor %}
</div>


  <h3>Upload Images</h3>
  <input type="file" name="image" id="image" multiple>
    <h4>Existing Images</h4>
    {% for img in existing_images %}
        <img src="{{ img.image.url }}" width="100" alt="Image">
    {% endfor %}

    <h3>Upload Files</h3>
    <input type="file" name="file" id="files" multiple>
    <h4>Existing Files</h4>
    {% for file in existing_files %}
    <li><a href="{{ file.file.url }}" download>{{ file.file.name }}</a></li>
    {% endfor %}

    <br>
    <input type="submit" value="Update Report">
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Script loaded');
    
        const radios = document.querySelectorAll('input[type="radio"]');
    
        radios.forEach(radio => {
            console.log('Event listener attached');
            radio.addEventListener('click', function () {
                console.log('Radio clicked');
                if (radio.getAttribute('data-last-clicked') === 'true') {
                    radio.checked = false;
                    radio.setAttribute('data-last-clicked', 'false');
                } else {
                    radio.setAttribute('data-last-clicked', 'true');
                }
    
                // Deselect other radios with the same name attribute if the current one is checked
                radios.forEach(otherRadio => {
                    if (otherRadio.name === radio.name && otherRadio !== radio) {
                        otherRadio.setAttribute('data-last-clicked', 'false');
                    }
                });
            });
        });
    
        // Simplified Add button function for organizations
        const orgFormSetsContainer = document.querySelector('.organization-formsets');
        const orgFormTemplate = orgFormSetsContainer.querySelector('.organization-form').cloneNode(true);
        
        document.getElementById('add-organization').addEventListener('click', function() {
            const newForm = orgFormTemplate.cloneNode(true);
            newForm.querySelectorAll('input').forEach(input => input.value = '');
            const removeBtn = newForm.querySelector('.remove-org-form');
            removeBtn.addEventListener('click', function() {
                newForm.remove();
            });
            orgFormSetsContainer.appendChild(newForm);
        });
    });
    </script>
    {% endblock %}