{% extends "base.html" %}
{% load static %}


{% block content %}
<h2>Edit Report</h2>
<style>
    .sdg-img {
    width: 100px; /* Adjust as needed */
    height: 100px; /* Adjust as needed */
}
</style>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% for field in report_form %}
        <p>
            {{ field.label_tag }}<br>
            {{ field }}
            {% if field.errors %}
                <div class="error">{{ field.errors|join:", " }}</div>
            {% endif %}
        </p>
{% endfor %}

    <h3>Organization Details</h3>
    {{ organization_formset.management_form }}
    {% for form in organization_formset %}
        {{ form.as_p }}
    {% endfor %}

    <div class="form-group">
    

    <h3>SDGs</h3>
    <div id="sdg-container">
        {% for i in sdg_list %}
            <div class="sdg-item">
                <img src="{% static 'css/sdg_'|add:i|add:'.png' %}" class="sdg-img" data-sdg="{{ i }}" alt="SDG {{ i }}">
                <div class="sdg-options">
                    <input type="radio" name="sdg_option_{{ i }}" value="direct" {% if i|add:0 in report.direct_sdgs %}checked{% endif %}> Direct
                    <input type="radio" name="sdg_option_{{ i }}" value="indirect" {% if i|add:0 in report.indirect_sdgs %}checked{% endif %}> Indirect
                </div>
            </div>
        {% endfor %}
    </div>
    

    
<div id="esd-themes-container">
    {% for theme in themes_esd %}
        <div class="esd-theme-item">
            {{ theme }} 
            <div class="esd-theme-options">
                <input type="radio" name="esd_theme_option_{{ theme }}" value="direct" {% if theme in report.direct_esd_themes %}checked{% endif %}> Direct
                <input type="radio" name="esd_theme_option_{{ theme }}" value="indirect" {% if theme in report.indirect_esd_themes %}checked{% endif %}> Indirect
            </div>
        </div>
    {% endfor %}
</div>

  
  <!-- ESD for 2030-Priority Action Areas -->
  <div id="esd-priority-container">
    {% for area in priority_action_areas %}
        <div class="esd-priority-item">
            {{ area }}
            <div class="esd-priority-options">
                <input type="radio" name="esd_priority_option_{{ area }}" value="direct" {% if area in report.direct_priority_areas %}checked{% endif %}> Direct
                <input type="radio" name="esd_priority_option_{{ area }}" value="indirect" {% if area in report.indirect_priority_areas %}checked{% endif %}> Indirect
            </div>
        </div>
    {% endfor %}
</div>


  <h3>Upload Images</h3>
  <input type="file" name="image" id="image" multiple>
    <h4>Existing Images</h4>
    {% for img in existing_images %}
        <img src="{{ img.image.url }}" width="100" alt="Image">
    {% endfor %}

    <h3>Upload Files</h3>
    <input type="file" name="file" id="files" multiple>
    <h4>Existing Files</h4>
    {% for file in existing_files %}
    <li><a href="{{ file.file.url }}" download>{{ file.file.name }}</a></li>
    {% endfor %}

    <br>
    <input type="submit" value="Update Report">
</form>

{% endblock %}
<script>

    
    document.addEventListener('DOMContentLoaded', function() {
    
    // Handle radio button behavior
    let radios = document.querySelectorAll('input[type="radio"]');
    radios.forEach(function(radio) {
        radio.addEventListener('click', function() {
            if (radio.getAttribute('data-checked') == 'true') {
                radio.checked = false;
                radio.removeAttribute('data-checked');
            } else {
                radio.setAttribute('data-checked', 'true');
            }
        });
    });
    
    
    // Simplified Add button function for organizations
    const orgFormSetsContainer = document.querySelector('.organization-formsets');
    const orgFormTemplate = orgFormSetsContainer.querySelector('.organization-form').cloneNode(true);
    
    document.getElementById('add-organization').addEventListener('click', function() {
        const newForm = orgFormTemplate.cloneNode(true);
    
        // Clear any input values in the cloned form
        newForm.querySelectorAll('input').forEach(input => input.value = '');
    
        const removeBtn = newForm.querySelector('.remove-org-form');
        removeBtn.addEventListener('click', function() {
            newForm.remove();
            // Potential re-indexing of formsets can be handled here if needed
        });
    
        orgFormSetsContainer.appendChild(newForm);
    });
    });
    </script>